(self.webpackChunk=self.webpackChunk||[]).push([[4336],{94194:function(ie,E,e){"use strict";var T=e(97857),M=e.n(T),L=e(13769),k=e.n(L),D=e(60806),d=e(86074),h=["id","className"],i=function(v){var r=v.id,j=v.className,y=k()(v,h);return(0,d.jsx)("img",M()(M()({},y),{},{src:"".concat(D.N,"/document/image/").concat(r),alt:"",className:j}))};E.Z=i},96449:function(ie,E,e){"use strict";e.d(E,{s:function(){return s}});var T=e(15009),M=e.n(T),L=e(99289),k=e.n(L),D=e(5574),d=e.n(D),h=e(5121),i=e(62435),s=function(r){var j=(0,i.useState)(""),y=d()(j,2),J=y[0],H=y[1],Y=(0,i.useCallback)(k()(M()().mark(function me(){var ce,de;return M()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,h.Z.get(r);case 2:ce=R.sent,de=ce.data,de.retcode!==0&&H(de==null?void 0:de.retmsg);case 5:case"end":return R.stop()}},me)})),[r]);return(0,i.useEffect)(function(){Y()},[Y]),J}},96330:function(ie,E,e){"use strict";e.d(E,{Rx:function(){return L},S8:function(){return d},Vr:function(){return h},cG:function(){return k},ld:function(){return i},oQ:function(){return D}});var T=e(9783),M=e.n(T),L=function(s){return s.Dataset="dataset",s.Testing="testing",s.Configuration="configuration",s}({}),k=function(s){return s.UNSTART="0",s.RUNNING="1",s.CANCEL="2",s.DONE="3",s.FAIL="4",s}({}),D=function(s){return s.Improvise="Improvise",s.Precise="Precise",s.Balance="Balance",s}({}),d=M()(M()(M()({},D.Improvise,{temperature:.9,top_p:.9,frequency_penalty:.2,presence_penalty:.4,max_tokens:512}),D.Precise,{temperature:.1,top_p:.3,frequency_penalty:.7,presence_penalty:.4,max_tokens:512}),D.Balance,{temperature:.5,top_p:.5,frequency_penalty:.7,presence_penalty:.4,max_tokens:512}),h=function(s){return s.Embedding="embedding",s.Chat="chat",s.Image2text="image2text",s.Speech2text="speech2text",s.Rerank="rerank",s}({}),i=function(s){return s.DocumentId="doc_id",s.KnowledgeId="id",s}({})},2039:function(ie,E,e){"use strict";e.d(E,{I3:function(){return me},pG:function(){return J},qM:function(){return ce}});var T=e(15009),M=e.n(T),L=e(99289),k=e.n(L),D=e(5574),d=e.n(D),h=e(21640),i=e(3321),s=e(18446),v=e.n(s),r=e(62435),j=e(67421),y=e(86074),J=function(){var R=(0,r.useState)(!1),Q=d()(R,2),q=Q[0],m=Q[1],u=function(){m(!0)},o=function(){m(!1)},c=function(){m(!q)};return{visible:q,showModal:u,hideModal:o,switchVisible:c}},H=function(R,Q){var q=useRef(),m=function(){};isEqual(Q,q.current)||(m=R(),q.current=Q),useEffect(function(){return function(){m&&m()}},[])};function Y(B){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q=useRef(),q=useState(!1),m=_slicedToArray(q,2),u=m[0],o=m[1],c=useState(),f=_slicedToArray(c,2),x=f[0],Z=f[1],n=R.onCompleted,ue=R.onError;return useEffect(function(){o(!0);var he=function(){var Se=_asyncToGenerator(_regeneratorRuntime().mark(function $(){return _regeneratorRuntime().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.prev=0,X.next=3,e(86635)(B);case 3:Q.current=X.sent.ReactComponent,n==null||n(B,Q.current),X.next=11;break;case 7:X.prev=7,X.t0=X.catch(0),ue==null||ue(X.t0),Z(X.t0);case 11:return X.prev=11,o(!1),X.finish(11);case 14:case"end":return X.stop()}},$,null,[[0,7,11,14]])}));return function(){return Se.apply(this,arguments)}}();he()},[B,n,ue]),{error:x,loading:u,SvgIcon:Q.current}}var me=function(){var R=i.Z.useApp(),Q=R.modal,q=(0,j.$G)(),m=q.t,u=(0,r.useCallback)(function(o){var c=o.onOk,f=o.onCancel;return new Promise(function(x,Z){Q.confirm({title:m("common.deleteModalTitle"),icon:(0,y.jsx)(h.Z,{}),okText:m("common.ok"),okType:"danger",cancelText:m("common.cancel"),onOk:function(){return k()(M()().mark(function ue(){var he;return M()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,$.next=3,c==null?void 0:c();case 3:he=$.sent,x(he),console.info(he),$.next=11;break;case 8:$.prev=8,$.t0=$.catch(0),Z($.t0);case 11:case"end":return $.stop()}},ue,null,[[0,8]])}))()},onCancel:function(){f==null||f()}})})},[m,Q]);return u},ce=function(R){return(0,j.$G)("translation",{keyPrefix:R})},de=function(){return useTranslation("translation",{keyPrefix:"common"})}},82182:function(ie,E,e){"use strict";e.d(E,{K2:function(){return Q},MA:function(){return R},PX:function(){return Y},SD:function(){return j},VJ:function(){return ce},aX:function(){return q},l5:function(){return de},qH:function(){return H},tP:function(){return me},w9:function(){return v},wK:function(){return r}});var T=e(97857),M=e.n(T),L=e(5574),k=e.n(L),D=e(2039),d=e(62435),h=e(6589),i=e(65534),s=e(25194),v=function(){var u=(0,h.useSearchParams)(),o=k()(u,1),c=o[0],f=c.get("id");return f||""},r=function(){var u=(0,h.useDispatch)(),o=v(),c=(0,D.I3)(),f=function(n){return function(){return u({type:"kFModel/document_rm",payload:{doc_id:n,kb_id:o}})}},x=function(n){return c({onOk:f(n)})};return{removeDocument:x}},j=function(){var u=(0,h.useDispatch)(),o=(0,i.pE)(),c=o.knowledgeId,f=(0,d.useCallback)(function(x){u({type:"knowledgeModel/getKnowledgeDetail",payload:{kb_id:x}})},[u]);return(0,d.useEffect)(function(){f(c)},[f,c]),f},y=function(){var u=useSelector(function(o){return o.knowledgeModel.knowledge});return u},J=function(){var u,o,c=y();return{defaultParserId:(u=c==null?void 0:c.parser_id)!==null&&u!==void 0?u:"",parserConfig:(o=c==null?void 0:c.parser_config)!==null&&o!==void 0?o:""}},H=function(){var u=(0,h.useDispatch)(),o=(0,D.I3)(),c=(0,d.useCallback)(function(x,Z){return function(){return u({type:"chunkModel/rm_chunk",payload:{chunk_ids:x,doc_id:Z}})}},[u]),f=(0,d.useCallback)(function(x,Z){return o({onOk:c(x,Z)})},[c,o]);return{removeChunk:f}},Y=function(){var u=(0,h.useDispatch)(),o=v(),c=(0,d.useCallback)(function(){u({type:"kSModel/getKbDetail",payload:{kb_id:o}})},[u,o]);(0,d.useEffect)(function(){c()},[c])},me=function(){var u=(0,h.useSelector)(function(f){return f.knowledgeModel}),o=u.data,c=o===void 0?[]:o;return c},ce=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=(0,h.useDispatch)(),c=(0,s.q)("knowledgeModel",["getList"]),f=(0,h.useSelector)(function(he){return he.knowledgeModel}),x=f.data,Z=x===void 0?[]:x,n=(0,d.useMemo)(function(){return u?Z.filter(function(he){return he.chunk_num>0}):Z},[Z,u]),ue=(0,d.useCallback)(function(){o({type:"knowledgeModel/getList"})},[o]);return(0,d.useEffect)(function(){ue()},[ue]),{list:n,loading:c,fetchList:ue}},de=function(){var u=(0,h.useSelector)(function(o){return o.kFModel.fileThumbnails});return u},B=function(u){var o=useDispatch(),c=de(),f=useCallback(function(x){o({type:"kFModel/fetch_document_thumbnails",payload:{doc_ids:x.join(",")}})},[o]);return useEffect(function(){u&&f(u)},[u,f]),{fileThumbnails:c,fetchFileThumbnails:f}},R=function(){var u=(0,h.useDispatch)(),o=(0,d.useCallback)(function(c){u({type:"kSModel/updateKb",payload:c})},[u]);return o},Q=function(){var u=(0,h.useSelector)(function(o){return o.kSModel.knowledgeDetails});return u},q=function(){var u=(0,h.useDispatch)(),o=v(),c=(0,d.useCallback)(function(f){u({type:"testingModel/testDocumentChunk",payload:M()(M()({},f),{},{kb_id:o})})},[u,o]);return c}},65534:function(ie,E,e){"use strict";e.d(E,{HK:function(){return s},Uu:function(){return i},nT:function(){return j},pE:function(){return v},wy:function(){return r}});var T=e(5574),M=e.n(T),L=e(96330),k=e(62435),D=e(6589),d=function(y){return y.Second="2",y.Third="3",y}({}),h=function(J){var H=(0,D.useLocation)(),Y=H.pathname,me=Y.split("/");return me[J]||""},i=function(){return h(d.Second)},s=function(){return h(d.Third)},v=function(){var J=(0,D.useSearchParams)(),H=M()(J,1),Y=H[0];return{documentId:Y.get(L.ld.DocumentId)||"",knowledgeId:Y.get(L.ld.KnowledgeId)||""}},r=function(){var J=(0,D.useNavigate)();return(0,k.useCallback)(function(H){J(H,{state:{from:H}})},[J])},j=function(){var J=(0,D.useNavigate)(),H=v(),Y=H.knowledgeId;return(0,k.useCallback)(function(){J("/knowledge/".concat(L.Rx.Dataset,"?id=").concat(Y))},[Y,J])}},25194:function(ie,E,e){"use strict";e.d(E,{q:function(){return k}});var T=function(d,h,i){return i.some(function(s){return h["".concat(d,"/").concat(s)]})},M=function(d){return new Promise(function(h){setTimeout(h,d)})},L=e(6589),k=function(d,h){var i=(0,L.useSelector)(function(s){return s.loading.effects});return T(d,i,h)}},82048:function(ie,E,e){"use strict";e.r(E),e.d(E,{default:function(){return An}});var T=e(9783),M=e.n(T),L=e(15009),k=e.n(L),D=e(99289),d=e.n(D),h=e(19632),i=e.n(h),s=e(5574),v=e.n(s),r=e(62435),j=e(6589),y=e(65534),J=function(){var t=(0,j.useDispatch)(),a=(0,y.pE)(),l=a.documentId,g=(0,r.useCallback)(function(){t({type:"chunkModel/chunk_list",payload:{doc_id:l}})},[t,l]);return g},H=e(82182),Y=e(45360),me=e(96074),ce=e(86250),de=e(75081),B=e(42075),R=e(11980),Q=e(93967),q=e.n(Q),m=e(94194),u=e(4393),o=e(84567),c=e(74627),f=e(72269),x=function(_){return _.Full="full",_.Ellipse="ellipse",_}({}),Z={image:"image___fDGTe",imagePreview:"imagePreview___N6faK",content:"content___dvAD4",contentEllipsis:"contentEllipsis___ku_hG",chunkCard:"chunkCard___FJadg",cardSelected:"cardSelected___xZpKQ"},n=e(86074),ue=function(t){var a=t.item,l=t.checked,g=t.handleCheckboxClick,C=t.editChunk,P=t.switchChunk,S=t.selected,K=t.clickChunkCard,O=t.textMode,A=Number(a.available_int),I=(0,r.useState)(A===1),b=v()(I,2),p=b[0],ee=b[1],N=function(w){ee(w),P(A===0?1:0,[a.chunk_id])},te=function(w){g(a.chunk_id,w.target.checked)},_e=function(){C(a.chunk_id)},le=function(){K(a.chunk_id)};return(0,n.jsx)(u.Z,{className:q()(Z.chunkCard,M()({},Z.cardSelected,S)),children:(0,n.jsxs)(ce.Z,{gap:"middle",justify:"space-between",children:[(0,n.jsx)(o.Z,{onChange:te,checked:l}),a.img_id&&(0,n.jsx)(c.Z,{placement:"right",content:(0,n.jsx)(m.Z,{id:a.img_id,className:Z.imagePreview}),children:(0,n.jsx)(m.Z,{id:a.img_id,className:Z.image})}),(0,n.jsx)("section",{onDoubleClick:_e,onClick:le,className:Z.content,children:(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:a.content_with_weight},className:q()(M()({},Z.contentEllipsis,O===x.Ellipse))})}),(0,n.jsx)("div",{children:(0,n.jsx)(f.Z,{checked:p,onChange:N})})]})})},he=ue,Se=e(25194),$=e(48689),we=e(99859),X=e(85576),Oe=e(79531),Ae=e(67421),Le=e(24969),Ne=e(9361),Ue=e(66309),Fe=e(52376),ze={tweenGroup:"tweenGroup___FzEVj"},Ge=function(t){var a=t.tags,l=t.setTags,g=Ne.Z.useToken(),C=g.token,P=(0,r.useState)(!1),S=v()(P,2),K=S[0],O=S[1],A=(0,r.useState)(""),I=v()(A,2),b=I[0],p=I[1],ee=(0,r.useRef)(null);(0,r.useEffect)(function(){if(K){var V;(V=ee.current)===null||V===void 0||V.focus()}},[K]);var N=function(U){var fe=a.filter(function(ge){return ge!==U});console.log(fe),l(fe)},te=function(){O(!0)},_e=function(U){p(U.target.value)},le=function(){b&&a.indexOf(b)===-1&&l([].concat(i()(a),[b])),O(!1),p("")},ae=function(U){var fe=(0,n.jsx)(Ue.Z,{closable:!0,onClose:function(Ce){Ce.preventDefault(),N(U)},children:U});return(0,n.jsx)("span",{style:{display:"inline-block"},children:fe},U)},w=a.map(ae),F={background:C.colorBgContainer,borderStyle:"dashed"};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:(0,n.jsx)(Fe.Z,{className:ze.tweenGroup,enter:{scale:.8,opacity:0,type:"from",duration:100},onEnd:function(U){(U.type==="appear"||U.type==="enter")&&(U.target.style="display: inline-block")},leave:{opacity:0,width:0,scale:0,duration:200},appear:!1,children:w})}),K?(0,n.jsx)(Oe.Z,{ref:ee,type:"text",size:"small",style:{width:78},value:b,onChange:_e,onBlur:le,onPressEnter:le}):(0,n.jsx)(Ue.Z,{onClick:te,style:F,children:(0,n.jsx)(Le.Z,{})})]})},He=Ge,$e=function(t){var a=t.doc_id,l=t.chunkId,g=(0,j.useDispatch)(),C=we.Z.useForm(),P=v()(C,1),S=P[0],K=(0,j.useSelector)(function(se){return se.chunkModel.isShowCreateModal}),O=(0,r.useState)(!1),A=v()(O,2),I=A[0],b=A[1],p=(0,r.useState)([]),ee=v()(p,2),N=ee[0],te=ee[1],_e=(0,Se.q)("chunkModel",["create_chunk"]),le=(0,H.qH)(),ae=le.removeChunk,w=(0,Ae.$G)(),F=w.t,V=function(){g({type:"chunkModel/setIsShowCreateModal",payload:!1})},U=(0,r.useCallback)(d()(k()().mark(function se(){var oe,ve,Ee,W,z;return k()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(console.info(l),!(l&&K)){pe.next=6;break}return pe.next=4,g({type:"chunkModel/get_chunk",payload:{chunk_id:l}});case 4:oe=pe.sent,(oe==null?void 0:oe.retcode)===0&&(ve=oe.data,Ee=ve.content_with_weight,W=ve.important_kwd,z=W===void 0?[]:W,S.setFieldsValue({content:Ee}),te(z));case 6:l||(te([]),S.setFieldsValue({content:void 0}));case 7:case"end":return pe.stop()}},se)})),[l,K,g,S]);(0,r.useEffect)(function(){U()},[U]);var fe=function(){var se=d()(k()().mark(function oe(){var ve;return k()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,S.validateFields();case 3:ve=W.sent,g({type:"chunkModel/create_chunk",payload:{content_with_weight:ve.content,doc_id:a,chunk_id:l,important_kwd:N}}),W.next=10;break;case 7:W.prev=7,W.t0=W.catch(0),console.log("Failed:",W.t0);case 10:case"end":return W.stop()}},oe,null,[[0,7]])}));return function(){return se.apply(this,arguments)}}(),ge=function(){if(l)return ae([l],a)},Ce=function(){b(!I)};return(0,n.jsxs)(X.Z,{title:"".concat(F(l?"common.edit":"common.create")," ").concat(F("chunk.chunk")),open:K,onOk:fe,onCancel:V,okButtonProps:{loading:_e},children:[(0,n.jsx)(we.Z,{form:S,autoComplete:"off",layout:"vertical",children:(0,n.jsx)(we.Z.Item,{label:F("chunk.chunk"),name:"content",rules:[{required:!0,message:F("chunk.chunkMessage")}],children:(0,n.jsx)(Oe.Z.TextArea,{autoSize:{minRows:4,maxRows:10}})})}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("p",{children:[F("chunk.keyword")," *"]}),(0,n.jsx)(He,{tags:N,setTags:te})]}),l&&(0,n.jsxs)("section",{children:[(0,n.jsx)(me.Z,{}),(0,n.jsxs)(B.Z,{size:"large",children:[(0,n.jsx)(o.Z,{onChange:Ce,checked:I,children:F("chunk.enabled")}),(0,n.jsxs)("span",{onClick:ge,children:[(0,n.jsx)($.Z,{})," ",F("common.delete")]})]})]})]})},Ve=$e,Je=Object.defineProperty,Re=Object.getOwnPropertySymbols,Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,Ze=(_,t,a)=>t in _?Je(_,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):_[t]=a,Ye=(_,t)=>{for(var a in t||(t={}))Qe.call(t,a)&&Ze(_,a,t[a]);if(Re)for(var a of Re(t))Xe.call(t,a)&&Ze(_,a,t[a]);return _};const qe=_=>r.createElement("svg",Ye({width:20,height:20,fill:"none",xmlns:"http://www.w3.org/2000/svg"},_),r.createElement("path",{d:"M5 10h10M2.5 5h15m-10 10h5",stroke:"#344054",strokeWidth:1.667,strokeLinecap:"round",strokeLinejoin:"round"}));var Zn="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTUgMTBoMTBNMi41IDVoMTVtLTEwIDEwaDUiIHN0cm9rZT0iIzM0NDA1NCIgc3Ryb2tlLXdpZHRoPSIxLjY2NyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",en=e(96330),nn=e(2039),tn=e(8751),an=e(18429),rn=e(82826),sn=e(49354),on=e(80882),Be=e(68795),un=e(22850),ln=e(68508),ye=e(78045),cn=e(92783),xe=e(15867),dn=un.Z.Text,hn=function(t){var a=t.getChunkList,l=t.selectAllChunk,g=t.checked,C=t.createChunk,P=t.removeChunk,S=t.switchChunk,K=t.changeChunkTextMode,O=(0,j.useSelector)(function(z){return z.chunkModel}),A=O.documentInfo,I=O.available,b=O.searchString,p=(0,j.useDispatch)(),ee=(0,H.w9)(),N=(0,r.useState)(!1),te=v()(N,2),_e=te[0],le=te[1],ae=(0,nn.qM)("chunk"),w=ae.t,F=(0,r.useCallback)(function(z){l(z.target.checked)},[l]),V=function(){le(!0)},U=function(Me){var pe=Me.target.value;p({type:"chunkModel/setSearchString",payload:pe}),p({type:"chunkModel/throttledGetChunkList",payload:A.id})},fe=function(){b.trim()||le(!1)},ge=(0,r.useCallback)(function(){P()},[P]),Ce=(0,r.useCallback)(function(){S(1)},[S]),se=(0,r.useCallback)(function(){S(0)},[S]),oe=(0,r.useMemo)(function(){return[{key:"1",label:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.Z,{onChange:F,checked:g,children:(0,n.jsx)("b",{children:w("selectAll")})})})},{type:"divider"},{key:"2",label:(0,n.jsxs)(B.Z,{onClick:Ce,children:[(0,n.jsx)(tn.Z,{}),(0,n.jsx)("b",{children:w("enabledSelected")})]})},{key:"3",label:(0,n.jsxs)(B.Z,{onClick:se,children:[(0,n.jsx)(an.Z,{}),(0,n.jsx)("b",{children:w("disabledSelected")})]})},{type:"divider"},{key:"4",label:(0,n.jsxs)(B.Z,{onClick:ge,children:[(0,n.jsx)($.Z,{}),(0,n.jsx)("b",{children:w("deleteSelected")})]})}]},[g,F,ge,Ce,se,w]),ve=(0,n.jsx)(ln.Z,{style:{width:200},items:oe,selectable:!1}),Ee=function(Me){l(!1),p({type:"chunkModel/setAvailable",payload:Me.target.value}),a()},W=(0,n.jsx)(ye.ZP.Group,{onChange:Ee,value:I,children:(0,n.jsxs)(B.Z,{direction:"vertical",children:[(0,n.jsx)(ye.ZP,{value:void 0,children:w("all")}),(0,n.jsx)(ye.ZP,{value:1,children:w("enabled")}),(0,n.jsx)(ye.ZP,{value:0,children:w("disabled")})]})});return(0,n.jsxs)(ce.Z,{justify:"space-between",align:"center",children:[(0,n.jsxs)(B.Z,{size:"middle",children:[(0,n.jsx)(j.Link,{to:"/knowledge/".concat(en.Rx.Dataset,"?id=").concat(ee),children:(0,n.jsx)(rn.Z,{})}),(0,n.jsx)(sn.Z,{}),(0,n.jsx)(dn,{ellipsis:{tooltip:A.name},style:{width:150},children:A.name})]}),(0,n.jsxs)(B.Z,{children:[(0,n.jsx)(cn.Z,{options:[{label:w(x.Full),value:x.Full},{label:w(x.Ellipse),value:x.Ellipse}],onChange:K}),(0,n.jsx)(c.Z,{content:ve,placement:"bottom",arrow:!1,children:(0,n.jsxs)(xe.ZP,{children:[w("bulk"),(0,n.jsx)(on.Z,{})]})}),_e?(0,n.jsx)(Oe.Z,{size:"middle",placeholder:w("search"),prefix:(0,n.jsx)(Be.Z,{}),allowClear:!0,onChange:U,onBlur:fe,value:b}):(0,n.jsx)(xe.ZP,{icon:(0,n.jsx)(Be.Z,{}),onClick:V}),(0,n.jsx)(c.Z,{content:W,placement:"bottom",arrow:!1,children:(0,n.jsx)(xe.ZP,{icon:(0,n.jsx)(qe,{})})}),(0,n.jsx)(xe.ZP,{icon:(0,n.jsx)(Le.Z,{}),type:"primary",onClick:function(){return C()}})]})]})},_n=hn,vn=e(97857),mn=e.n(vn),fn=e(21687),be=e(49723),gn=e(65400),Cn=function(){var t=(0,j.useSelector)(function(a){return a.chunkModel.documentInfo});return t},pn=function(){var t=(0,j.useSelector)(function(a){return a.chunkModel.data});return t},kn=function(){var t=(0,r.useState)(""),a=v()(t,2),l=a[0],g=a[1],C=(0,r.useCallback)(function(P){g(P)},[]);return{handleChunkCardClick:C,selectedChunkId:l}},Dn=function(t){var a,l=pn();return(a=l.find(function(g){return g.chunk_id===t}))!==null&&a!==void 0?a:{}},jn=function(t){var a=(0,r.useState)({width:849,height:1200}),l=v()(a,2),g=l[0],C=l[1],P=Dn(t),S=(0,r.useMemo)(function(){return(0,gn.q1)(P,g)},[P,g]),K=function(A,I){C(function(b){return b.height!==I||b.width!==A?{height:I,width:A}:b})};return{highlights:S,setWidthAndHeight:K}},En=function(){return(0,Se.q)("chunkModel",["create_hunk","chunk_list","switch_chunk"])},Mn=function(){var t=(0,r.useState)(x.Full),a=v()(t,2),l=a[0],g=a[1],C=(0,r.useCallback)(function(P){g(P)},[]);return{textMode:l,changeChunkTextMode:C}},Pn=e(60806),Bn=function(){var t=useState(),a=_slicedToArray(t,2),l=a[0],g=a[1],C=useState(null),P=_slicedToArray(C,2),S=P[0],K=P[1],O=useSize(S),A=useCallback(function(I){I&&g(I)},[]);return useEffect(function(){A(O==null?void 0:O.width)},[O==null?void 0:O.width,A]),{containerWidth:l,setContainerRef:K}};function Sn(_,t,a){return a===2||_.trim()!==""&&t.match(_)?"<mark>".concat(_,"</mark>"):_.replace(t,function(l){return"<mark>".concat(l,"</mark>")})}var Kn=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=useCallback(function(l){return Sn(l.str,t,l.pageNumber)},[t]);return a},bn=function(){var t=(0,y.pE)(),a=t.documentId,l=(0,r.useMemo)(function(){return"".concat(Pn.N,"/document/get/").concat(a)},[a]);return l},Ke=e(96449),wn=e(4772),yn={documentContainer:"documentContainer___TU9k2"},xn=function(t){var a=t.comment;return a.text?(0,n.jsxs)("div",{className:"Highlight__popup",children:[a.emoji," ",a.text]}):null},In=function(t){var a=t.selectedChunkId,l=bn();(0,Ke.s)(l);var g=jn(a),C=g.highlights,P=g.setWidthAndHeight,S=(0,r.useRef)(function(){}),K=(0,Ke.s)(l),O=function(){};return(0,r.useEffect)(function(){C.length>0&&S.current(C[0])},[C]),(0,n.jsx)("div",{className:yn.documentContainer,children:(0,n.jsx)(be.Hz,{url:l,beforeLoad:(0,n.jsx)(fn.Z,{active:!0}),workerSrc:"/pdfjs-dist/pdf.worker.min.js",errorMessage:(0,n.jsx)(wn.Z,{children:K}),children:function(I){return I.getPage(1).then(function(b){var p=b.getViewport({scale:1}),ee=p.width,N=p.height;P(ee,N)}),(0,n.jsx)(be.Nb,{pdfDocument:I,enableAreaSelection:function(p){return p.altKey},onScrollChange:O,scrollRef:function(p){S.current=p},onSelectionFinished:function(){return null},highlightTransform:function(p,ee,N,te,_e,le,ae){var w=!(p.content&&p.content.image),F=w?(0,n.jsx)(be.y$,{isScrolledTo:ae,position:p.position,comment:p.comment}):(0,n.jsx)(be.PD,{isScrolledTo:ae,highlight:p,onChange:function(){}});return(0,n.jsx)(be.GI,{popupContent:(0,n.jsx)(xn,mn()({},p)),onMouseOver:function(U){return N(p,function(){return U})},onMouseOut:te,children:F},ee)},highlights:C})}})})},Tn=In,ke={chunkPage:"chunkPage___Mlm1d",filter:"filter___z5K1X",pagePdfWrapper:"pagePdfWrapper___NxUun",pageWrapper:"pageWrapper___wkiwd",pageContent:"pageContent___fubpP",spin:"spin___OiDil",documentPreview:"documentPreview___tbu9J",chunkContainer:"chunkContainer___m_m6K",chunkOtherContainer:"chunkOtherContainer___bj5TE",pageFooter:"pageFooter___O05bO",container:"container___CzJsH",content:"content___bh0q5",context:"context___cC9j3",footer:"footer___W4r5v",text:"text___fZ1Dv",card:"card___Aqbq7"},On=function(){var t=(0,j.useDispatch)(),a=(0,j.useSelector)(function(G){return G.chunkModel}),l=(0,r.useState)([]),g=v()(l,2),C=g[0],P=g[1],S=(0,j.useSearchParams)(),K=v()(S,1),O=K[0],A=a.data,I=A===void 0?[]:A,b=a.total,p=a.pagination,ee=En(),N=O.get("doc_id")||"",te=(0,r.useState)(),_e=v()(te,2),le=_e[0],ae=_e[1],w=(0,H.qH)(),F=w.removeChunk,V=Cn(),U=kn(),fe=U.handleChunkCardClick,ge=U.selectedChunkId,Ce=V.type==="pdf",se=(0,Ae.$G)(),oe=se.t,ve=Mn(),Ee=ve.changeChunkTextMode,W=ve.textMode,z=J(),Me=(0,r.useCallback)(function(G){ae(G),t({type:"chunkModel/setIsShowCreateModal",payload:!0})},[t]),pe=function(re,De){P([]),t({type:"chunkModel/setPagination",payload:{current:re,pageSize:De}}),z()},Ln=(0,r.useCallback)(function(G){P(G?I.map(function(re){return re.chunk_id}):[])},[I]),Un=(0,r.useCallback)(function(G,re){P(function(De){var ne=De.findIndex(function(Te){return Te===G}),Pe=i()(De);return re&&ne===-1?Pe.push(G):!re&&ne!==-1&&Pe.splice(ne,1),Pe})},[]),Ie=(0,r.useCallback)(function(){Y.ZP.warning(oe("message.pleaseSelectChunk"))},[oe]),Rn=(0,r.useCallback)(d()(k()().mark(function G(){var re;return k()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:if(!(C.length>0)){ne.next=7;break}return ne.next=3,F(C,N);case 3:re=ne.sent,re===0&&P([]),ne.next=8;break;case 7:Ie();case 8:case"end":return ne.stop()}},G)})),[C,N,F,Ie]),We=(0,r.useCallback)(function(){var G=d()(k()().mark(function re(De,ne){var Pe,Te;return k()().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(Pe=ne,ne){je.next=6;break}if(Pe=C,C.length!==0){je.next=6;break}return Ie(),je.abrupt("return");case 6:return je.next=8,t({type:"chunkModel/switch_chunk",payload:{chunk_ids:Pe,available_int:De,doc_id:N}});case 8:Te=je.sent,!ne&&Te===0&&z();case 10:case"end":return je.stop()}},re)}));return function(re,De){return G.apply(this,arguments)}}(),[t,N,z,C,Ie]);return(0,r.useEffect)(function(){return z(),function(){t({type:"chunkModel/resetFilter"})}},[t,z]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:ke.chunkPage,children:[(0,n.jsx)(_n,{getChunkList:z,selectAllChunk:Ln,createChunk:Me,removeChunk:Rn,checked:C.length===I.length,switchChunk:We,changeChunkTextMode:Ee}),(0,n.jsx)(me.Z,{}),(0,n.jsxs)(ce.Z,{flex:1,gap:"middle",children:[(0,n.jsxs)(ce.Z,{vertical:!0,className:Ce?ke.pagePdfWrapper:ke.pageWrapper,children:[(0,n.jsx)(de.Z,{spinning:ee,className:ke.spin,size:"large",children:(0,n.jsx)("div",{className:ke.pageContent,children:(0,n.jsx)(B.Z,{direction:"vertical",size:"middle",className:q()(ke.chunkContainer,M()({},ke.chunkOtherContainer,!Ce)),children:I.map(function(G){return(0,n.jsx)(he,{item:G,editChunk:Me,checked:C.some(function(re){return re===G.chunk_id}),handleCheckboxClick:Un,switchChunk:We,clickChunkCard:fe,selected:G.chunk_id===ge,textMode:W},G.chunk_id)})})})}),(0,n.jsx)("div",{className:ke.pageFooter,children:(0,n.jsx)(R.Z,{responsive:!0,showLessItems:!0,showQuickJumper:!0,showSizeChanger:!0,onChange:pe,pageSize:p.pageSize,pageSizeOptions:[10,30,60,90],current:p.current,size:"small",total:b})})]}),Ce&&(0,n.jsx)("section",{className:ke.documentPreview,children:(0,n.jsx)(Tn,{selectedChunkId:ge})})]})]}),(0,n.jsx)(Ve,{doc_id:N,chunkId:le})]})},An=On},4772:function(ie,E,e){"use strict";e.d(E,{Z:function(){return i}});var T=e(86250),M=e(38925),L=e(2039),k=e(62435),D={errorWrapper:"errorWrapper___QfVXQ"},d=e(86074),h=function(v){var r=v.children,j=(0,L.qM)("fileManager"),y=j.t;return(0,d.jsx)(T.Z,{align:"center",justify:"center",className:D.errorWrapper,children:(0,d.jsx)(M.Z,{type:"error",message:(0,d.jsx)("h2",{children:r||y("fileError")})})})},i=h},65400:function(ie,E,e){"use strict";e.d(E,{RT:function(){return k},Re:function(){return L},YC:function(){return d},Ze:function(){return D},q1:function(){return M}});var T=e(57632),M=function(i,s){var v;return Array.isArray(i==null?void 0:i.positions)&&i.positions.every(function(r){return Array.isArray(r)})?i==null||(v=i.positions)===null||v===void 0?void 0:v.map(function(r){var j={width:s.width,height:s.height,x1:r[1],x2:r[2],y1:r[3],y2:r[4]};return{id:(0,T.Z)(),comment:{text:"",emoji:""},content:{text:i.content_with_weight},position:{boundingRect:j,rects:[j],pageNumber:r[0]}}}):[]},L=function(i){return i.status==="done"},k=function(i){var s;return(s=i==null?void 0:i.slice(i.lastIndexOf(".")+1).toLowerCase())!==null&&s!==void 0?s:""},D=function(i){return k(i)==="pdf"},d=function(i){return i.split(`
`).length}},86635:function(ie){function E(e){return Promise.resolve().then(function(){var T=new Error("Cannot find module '"+e+"'");throw T.code="MODULE_NOT_FOUND",T})}E.keys=function(){return[]},E.resolve=E,E.id=86635,ie.exports=E},64838:function(){},27922:function(){},15212:function(){},85777:function(){},76929:function(){},45036:function(){}}]);

//# sourceMappingURL=p__add-knowledge__components__knowledge-chunk__index.a7115f4f.async.js.map