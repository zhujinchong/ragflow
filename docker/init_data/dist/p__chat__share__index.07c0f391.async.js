"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5881],{6171:function(K,L,e){e.d(L,{Z:function(){return E}});var O=e(87462),v=e(62435),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},i=M,R=e(84089),V=function(H,z){return v.createElement(R.Z,(0,O.Z)({},H,{ref:z,icon:i}))},E=v.forwardRef(V)},90814:function(K,L,e){e.d(L,{Z:function(){return E}});var O=e(87462),v=e(62435),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"},i=M,R=e(84089),V=function(H,z){return v.createElement(R.Z,(0,O.Z)({},H,{ref:z,icon:i}))},E=v.forwardRef(V)},35749:function(K,L,e){e.r(L),e.d(L,{default:function(){return Le}});var O=e(9783),v=e.n(O),M=e(88964),i=e(1079),R=e(2039),V=e(7134),E=e(86250),J=e(2487),H=e(75081),z=e(79531),_=e(15867),ee=e(93967),Q=e.n(ee),ne=e(18334),ae=e(46693),te=e(49468),se=e(82182),w=e(65400),m=e(62435),re=e(46008),oe=e(19632),X=e.n(oe),le=e(97857),y=e.n(le),ie=e(15009),A=e.n(ie),de=e(99289),F=e.n(de),ue=e(5574),Y=e.n(ue),k=e(74471),ve=e(38725),ce=e(25194),me=e(60806),fe=e(57557),ge=e.n(fe),he=e(6589),b=e(57632),q=e(41923),Ce=function(){var r=(0,he.useSearchParams)(),d=Y()(r,1),l=d[0],Z=(0,m.useState)(""),f=Y()(Z,2),o=f[0],c=f[1],I=(0,k.ZK)(),x=l.get("shared_id"),g=l.get("user_id"),h=(0,m.useCallback)(F()(A()().mark(function S(){var a,n,s;return A()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(console.info(x),!x){j.next=7;break}return j.next=4,I(g!=null?g:void 0);case 4:n=j.sent,s=(a=n.data)===null||a===void 0?void 0:a.id,s&&c(s);case 7:case"end":return j.stop()}},S)})),[I,x,g]);return(0,m.useEffect)(function(){h()},[h]),{conversationId:o}},Ie=function(r){var d=(0,m.useState)({}),l=Y()(d,2),Z=l[0],f=l[1],o=(0,k.ik)(),c=(0,ce.q)("chatModel",["getExternalConversation"]),I=(0,q.qJ)(Z),x=(0,m.useCallback)(function(a){f(function(n){var s;return y()(y()({},n),{},{message:[].concat(X()((s=n.message)!==null&&s!==void 0?s:[]),[{role:i.C.User,content:a,id:(0,b.Z)()},{role:i.C.Assistant,content:"",id:(0,b.Z)(),reference:[]}])})})},[]),g=(0,m.useCallback)(function(a){f(function(n){var s,u=(s=n.message)===null||s===void 0?void 0:s.at(-1);return u?y()(y()({},n),{},{message:[].concat(X()(n.message.slice(0,-1)),[y()(y()({},u),{},{content:a.answer,reference:a.reference})])}):n})},[]),h=(0,m.useCallback)(function(){f(function(a){var n=a.message.slice(0,-2);return y()(y()({},a),{},{message:n})})},[]),S=(0,m.useCallback)(F()(A()().mark(function a(){var n;return A()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r){u.next=5;break}return u.next=3,o(r);case 3:n=u.sent,n.retcode===0&&f(n.data);case 5:case"end":return u.stop()}},a)})),[r,o]);return(0,m.useEffect)(function(){S()},[S]),{currentConversation:Z,addNewestConversation:x,removeLatestMessage:h,loading:c,ref:I,setCurrentConversation:f,addNewestAnswer:g}},Se=function(r,d,l,Z,f){var o=r.id,c=(0,k.ZK)(),I=(0,q.NT)(),x=I.handleInputChange,g=I.value,h=I.setValue,S=(0,ve.H0)(me.Z.completeExternalConversation),a=S.send,n=S.answer,s=S.done,u=(0,m.useCallback)(function(){var N=F()(A()().mark(function T($,p){var U,W;return A()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,a({conversation_id:p!=null?p:o,quote:!1,messages:[].concat(X()(((U=r==null?void 0:r.message)!==null&&U!==void 0?U:[]).map(function(Oe){return ge()(Oe,"id")})),[{role:i.C.User,content:$}])});case 2:W=B.sent,(W==null?void 0:W.status)===200||(h($),l());case 4:case"end":return B.stop()}},T)}));return function(T,$){return N.apply(this,arguments)}}(),[o,r==null?void 0:r.message,l,h,a]),j=(0,m.useCallback)(function(){var N=F()(A()().mark(function T($){var p,U;return A()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(o===""){P.next=4;break}u($),P.next=8;break;case 4:return P.next=6,c("user id");case 6:p=P.sent,p.retcode===0&&(U=p.data.id,u($,U));case 8:case"end":return P.stop()}},T)}));return function(T){return N.apply(this,arguments)}}(),[o,c,u]);(0,m.useEffect)(function(){n.answer&&f(n)},[n,f]);var G=(0,m.useCallback)(function(){s&&(h(""),d(g),j(g.trim()))},[d,s,j,h,g]);return{handlePressEnter:G,handleInputChange:x,value:g,loading:!s}},xe=e(35293),C={chatWrapper:"chatWrapper___V2STu",chatContainer:"chatContainer___JkSeI",messageContainer:"messageContainer___v6SB0",messageItem:"messageItem___TrVz4",messageItemSection:"messageItemSection___pwRam",messageItemSectionLeft:"messageItemSectionLeft___zDs1m",messageItemSectionRight:"messageItemSectionRight___ur1Xe",messageItemContent:"messageItemContent___UoYrp",messageItemContentReverse:"messageItemContentReverse___ExQIi",messageText:"messageText___OnPWu",messageEmpty:"messageEmpty___RS8fF",thumbnailImg:"thumbnailImg___ax__e",messageItemLeft:"messageItemLeft___VsUha",messageItemRight:"messageItemRight___NX0ko"},t=e(86074),je=function(r){var d=r.item,l=r.reference,Z=r.loading,f=Z===void 0?!1:Z,o=d.role===i.C.Assistant,c=(0,R.qM)("chat"),I=c.t,x=(0,se.l5)(),g=(0,te.pC)(),h=(0,m.useMemo)(function(){var a;return(a=l==null?void 0:l.doc_aggs)!==null&&a!==void 0?a:[]},[l==null?void 0:l.doc_aggs]),S=(0,m.useMemo)(function(){var a,n=d.content;return n===""&&(n=I("searching")),f?(a=n)===null||a===void 0?void 0:a.concat("~~2$$"):n},[d.content,f,I]);return(0,t.jsx)("div",{className:Q()(C.messageItem,v()(v()({},C.messageItemLeft,d.role===i.C.Assistant),C.messageItemRight,d.role===i.C.User)),children:(0,t.jsx)("section",{className:Q()(C.messageItemSection,v()(v()({},C.messageItemSectionLeft,d.role===i.C.Assistant),C.messageItemSectionRight,d.role===i.C.User)),children:(0,t.jsxs)("div",{className:Q()(C.messageItemContent,v()({},C.messageItemContentReverse,d.role===i.C.User)),children:[d.role===i.C.User?(0,t.jsx)(V.C,{size:40,src:"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"}):(0,t.jsx)(M.r,{}),(0,t.jsxs)(E.Z,{vertical:!0,gap:8,flex:1,children:[(0,t.jsx)("b",{children:o?"":"You"}),(0,t.jsx)("div",{className:C.messageText,children:(0,t.jsx)(re.Z,{reference:l,clickDocumentButton:function(){},content:S})}),o&&h.length>0&&(0,t.jsx)(J.Z,{bordered:!0,dataSource:h,renderItem:function(n){var s=x[n.doc_id],u=(0,w.RT)(n.doc_name);return(0,t.jsx)(J.Z.Item,{children:(0,t.jsxs)(E.Z,{gap:"small",align:"center",children:[s?(0,t.jsx)("img",{src:s,className:C.thumbnailImg}):(0,t.jsx)(ae.Z,{name:"file-icon/".concat(u),width:24}),(0,t.jsx)(ne.Z,{link:g(n.doc_id),preventDefault:!(0,w.Ze)(n.doc_name),children:n.doc_name})]})})}})]})]})})})},Ze=function(){var r,d=(0,R.qM)("chat"),l=d.t,Z=Ce(),f=Z.conversationId,o=Ie(f),c=o.currentConversation,I=o.addNewestConversation,x=o.removeLatestMessage,g=o.ref,h=o.loading,S=o.setCurrentConversation,a=o.addNewestAnswer,n=Se(c,I,x,S,a),s=n.handlePressEnter,u=n.handleInputChange,j=n.value,G=n.loading;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(E.Z,{flex:1,className:C.chatContainer,vertical:!0,children:[(0,t.jsxs)(E.Z,{flex:1,vertical:!0,className:C.messageContainer,children:[(0,t.jsx)("div",{children:(0,t.jsx)(H.Z,{spinning:h,children:c==null||(r=c.message)===null||r===void 0?void 0:r.map(function(N,T){return(0,t.jsx)(je,{item:N,reference:(0,xe.oI)(c,N),loading:N.role===i.C.Assistant&&G&&(c==null?void 0:c.message.length)-1===T},N.id)})})}),(0,t.jsx)("div",{ref:g})]}),(0,t.jsx)(z.Z,{size:"large",placeholder:l("sendPlaceholder"),value:j,suffix:(0,t.jsx)(_.ZP,{type:"primary",onClick:s,loading:G,children:l("send")}),onPressEnter:s,onChange:u})]})})},Me=(0,m.forwardRef)(Ze),Re=function(){return(0,t.jsx)("div",{className:C.chatWrapper,children:(0,t.jsx)(Me,{})})},Le=Re},38780:function(K,L){const e=function(){const O=Object.assign({},arguments.length<=0?void 0:arguments[0]);for(let v=1;v<arguments.length;v++){const M=v<0||arguments.length<=v?void 0:arguments[v];M&&Object.keys(M).forEach(i=>{const R=M[i];R!==void 0&&(O[i]=R)})}return O};L.Z=e}}]);

//# sourceMappingURL=p__chat__share__index.07c0f391.async.js.map